"use client";

import React, { useState } from 'react';

const FactQuestions = () => {
  const [questions, setQuestions] = useState([
    { id: 1, name: 'Mr Admin Muna', question: 'What is the capital of France?', category: 'Geography', language: 'English', dateAdded: '22nd May, 2025', status: 'ACTIVE', engagementLevel: 'All', subscriptionType: 'All', selectedUsers: 'All' },
    { id: 2, name: 'Mr Admin Muna', question: 'Who invented the telephone?', category: 'History', language: 'English', dateAdded: '22nd May, 2025', status: 'ACTIVE', engagementLevel: 'All', subscriptionType: 'All', selectedUsers: 'All' },
    { id: 3, name: 'Mr Admin Muna', question: 'What is 2 + 2?', category: 'Math', language: 'Spanish', dateAdded: '22nd May, 2025', status: 'ACTIVE', engagementLevel: 'All', subscriptionType: 'All', selectedUsers: 'All' },
    { id: 4, name: 'Mr Admin Muna', question: 'What is the tallest mountain?', category: 'Geography', language: 'French', dateAdded: '22nd May, 2025', status: 'ACTIVE', engagementLevel: 'All', subscriptionType: 'All', selectedUsers: 'All' },
    { id: 5, name: 'Mr Admin Muna', question: 'Who wrote Hamlet?', category: 'Literature', language: 'English', dateAdded: '22nd May, 2025', status: 'ACTIVE', engagementLevel: 'All', subscriptionType: 'All', selectedUsers: 'All' },
    { id: 6, name: 'Mr Admin Muna', question: 'What is the speed of light?', category: 'Science', language: 'English', dateAdded: '22nd May, 2025', status: 'ACTIVE', engagementLevel: 'All', subscriptionType: 'All', selectedUsers: 'All' },
    { id: 7, name: 'Mr Admin Muna', question: 'What is the capital of Japan?', category: 'Geography', language: 'English', dateAdded: '22nd May, 2025', status: 'ACTIVE', engagementLevel: 'All', subscriptionType: 'All', selectedUsers: 'All' },
    { id: 8, name: 'Mr Admin Muna', question: 'Who discovered gravity?', category: 'History', language: 'English', dateAdded: '22nd May, 2025', status: 'ACTIVE', engagementLevel: 'All', subscriptionType: 'All', selectedUsers: 'All' },
    { id: 9, name: 'Mr Admin Muna', question: 'What is 5 + 5?', category: 'Math', language: 'Spanish', dateAdded: '22nd May, 2025', status: 'ACTIVE', engagementLevel: 'All', subscriptionType: 'All', selectedUsers: 'All' },
    { id: 10, name: 'Mr Admin Muna', question: 'What is the deepest ocean?', category: 'Geography', language: 'French', dateAdded: '22nd May, 2025', status: 'ACTIVE', engagementLevel: 'All', subscriptionType: 'All', selectedUsers: 'All' },
    { id: 11, name: 'Mr Admin Muna', question: 'Who wrote Romeo and Juliet?', category: 'Literature', language: 'English', dateAdded: '22nd May, 2025', status: 'ACTIVE', engagementLevel: 'All', subscriptionType: 'All', selectedUsers: 'All' },
    { id: 12, name: 'Mr Admin Muna', question: 'What is the boiling point of water?', category: 'Science', language: 'English', dateAdded: '22nd May, 2025', status: 'ACTIVE', engagementLevel: 'All', subscriptionType: 'All', selectedUsers: 'All' },
  ]);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterGeneral, setFilterGeneral] = useState('GENERAL');
  const [filterCategory, setFilterCategory] = useState('');
  const [filterLanguage, setFilterLanguage] = useState('');
  const [openDropdownId, setOpenDropdownId] = useState(null);
  const [currentPage, setCurrentPage] = useState(1);
  const [isViewModalOpen, setIsViewModalOpen] = useState(false);
  const [selectedQuestion, setSelectedQuestion] = useState(null);
  const [isEditing, setIsEditing] = useState(false);
  const itemsPerPage = 10;

  const filteredQuestions = questions.filter((question) => {
    const matchesSearch = question.question.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesGeneral = filterGeneral === 'GENERAL' || question.category === filterGeneral;
    const matchesCategory = !filterCategory || question.category === filterCategory;
    const matchesLanguage = !filterLanguage || question.language === filterLanguage;
    return matchesSearch && matchesGeneral && matchesCategory && matchesLanguage;
  });

  const totalPages = Math.ceil(filteredQuestions.length / itemsPerPage);
  const paginatedQuestions = filteredQuestions.slice(
    (currentPage - 1) * itemsPerPage,
    currentPage * itemsPerPage
  );

  const handleFilter = () => {
    console.log('Filter applied:', { filterGeneral, filterCategory, filterLanguage });
  };

  const handleSearch = () => {
    console.log('Search for:', searchQuery);
  };

  const toggleDropdown = (id) => {
    setOpenDropdownId(openDropdownId === id ? null : id);
  };

  const handleAction = (action, id) => {
    const question = questions.find((q) => q.id === id);
    if (action === 'View') {
      setSelectedQuestion(question);
      setIsViewModalOpen(true);
    } else if (action === 'Edit') {
      setSelectedQuestion({ ...question });
      setIsEditing(true);
      setIsViewModalOpen(true);
    } else if (action === 'Delete') {
      console.log('Delete for question ID:', id);
    }
    setOpenDropdownId(null);
  };

  const handleShare = () => {
    const shareUrl = window.location.href;
    const shareText = 'Check out these fact questions! ' + shareUrl;

    if (navigator.share) {
      navigator.share({
        title: 'Fact Questions',
        text: shareText,
        url: shareUrl,
      }).catch((error) => console.log('Error sharing:', error));
    } else {
      const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}`;
      const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
      const linkedinUrl = `https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(shareUrl)}&title=Fact Questions&summary=${encodeURIComponent(shareText)}`;
      console.log('Share manually:', { twitterUrl, facebookUrl, linkedinUrl });
      alert(`Share via:\nTwitter: ${twitterUrl}\nFacebook: ${facebookUrl}\nLinkedIn: ${linkedinUrl}`);
    }
  };

  const handlePreviousPage = () => {
    if (currentPage > 1) setCurrentPage(currentPage - 1);
  };

  const handleNextPage = () => {
    if (currentPage < totalPages) setCurrentPage(currentPage + 1);
  };

  const handleSave = () => {
    setQuestions(questions.map((q) => (q.id === selectedQuestion.id ? selectedQuestion : q)));
    setIsEditing(false);
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    setSelectedQuestion((prev) => ({ ...prev, [name]: value }));
  };

  return (
    <div className="container mx-auto p-6 bg-gray-50 min-h-screen">
      {/* Filter Section */}
      <div className="bg-white rounded-lg p-4 mb-6 flex justify-between items-center">
        <div className="flex items-center gap-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Filter Question</label>
            <div className="flex gap-2">
              <select
                value={filterGeneral}
                onChange={(e) => setFilterGeneral(e.target.value)}
                className="p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <option>GENERAL</option>
                <option>Geography</option>
                <option>History</option>
                <option>Math</option>
                <option>Literature</option>
                <option>Science</option>
              </select>
              <select
                value={filterCategory}
                onChange={(e) => setFilterCategory(e.target.value)}
                className="p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <option value="">By Category</option>
                <option>Geography</option>
                <option>History</option>
                <option>Math</option>
                <option>Literature</option>
                <option>Science</option>
              </select>
              <select
                value={filterLanguage}
                onChange={(e) => setFilterLanguage(e.target.value)}
                className="p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <option value="">By Language</option>
                <option>English</option>
                <option>Spanish</option>
                <option>French</option>
              </select>
              <button
                onClick={handleFilter}
                className="px-4 py-2 bg-blue-300 text-white rounded-md text-sm hover:bg-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                Filter Questions
              </button>
            </div>
          </div>
        </div>
        <div className="flex items-center gap-2">
          <label className="block text-sm font-medium text-gray-700 mb-1">Search Question</label>
          <input
            type="text"
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Search"
          />
          <button
            onClick={handleSearch}
            className="px-4 py-2 bg-blue-300 text-white rounded-md text-sm hover:bg-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            Search
          </button>
        </div>
      </div>

      {/* Table */}
      <div className="bg-white rounded-lg shadow-md border border-gray-200">
        <div className="overflow-x-auto">
          <table className="w-full text-left">
            <thead>
              <tr className="bg-gray-100 border-b border-gray-200">
                <th className="p-4 text-sm font-medium text-gray-700">
                  <input type="checkbox" className="mr-2" />
                  Question
                </th>
                <th className="p-4 text-sm font-medium text-gray-700">Question Type</th>
                <th className="p-4 text-sm font-medium text-gray-700">Current Status</th>
                <th className="p-4 text-sm font-medium text-gray-700">Created At</th>
                <th className="p-4 text-sm font-medium text-gray-700">Actions</th>
              </tr>
            </thead>
            <tbody>
              {paginatedQuestions.map((question) => (
                <tr key={question.id} className="border-b border-gray-200 hover:bg-gray-50">
                  <td className="p-4 text-sm text-gray-600">
                    <input type="checkbox" className="mr-2" />
                    {question.question}
                  </td>
                  <td className="p-4 text-sm text-gray-600">{question.category}</td>
                  <td className="p-4 text-sm text-gray-600">
                    <button className="px-2 py-1 bg-blue-200 text-white rounded text-xs">{question.status}</button>
                  </td>
                  <td className="p-4 text-sm text-gray-600">{question.dateAdded}</td>
                  <td className="p-4 text-sm text-gray-600 relative">
                    <button
                      onClick={() => toggleDropdown(question.id)}
                      className="text-blue-500 hover:text-blue-700"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                      >
                        <circle cx="12" cy="12" r="1" />
                        <circle cx="12" cy="5" r="1" />
                        <circle cx="12" cy="19" r="1" />
                      </svg>
                    </button>
                    {openDropdownId === question.id && (
                      <div className="absolute right-4 mt-2 w-32 bg-white border border-gray-200 rounded-md shadow-lg z-10">
                        <button
                          onClick={() => handleAction('View', question.id)}
                          className="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                        >
                          View
                        </button>
                        <button
                          onClick={() => handleAction('Edit', question.id)}
                          className="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                        >
                          Edit
                        </button>
                        <button
                          onClick={() => handleAction('Delete', question.id)}
                          className="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100"
                        >
                          Delete
                        </button>
                      </div>
                    )}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>

      {/* Share and Pagination */}
      <div className="mt-4 flex justify-between items-center bg-gray-200 p-4 rounded-lg">
        <button
          onClick={handleShare}
          className="px-4 py-2 bg-blue-700 text-white rounded-md text-sm flex items-center hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          Share <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="ml-2"><polyline points="18 15 12 21 6 15"></polyline><polyline points="6 9 12 3 18 9"></polyline></svg>
        </button>
        <div className="flex gap-2">
          <button
            onClick={handlePreviousPage}
            className="px-4 py-2 bg-blue-300 text-white rounded-md text-sm hover:bg-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"
            disabled={currentPage === 1}
          >
            Fetch previous 10
          </button>
          <button
            onClick={handleNextPage}
            className="px-4 py-2 bg-blue-300 text-white rounded-md text-sm hover:bg-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"
            disabled={currentPage === totalPages}
          >
            Fetch Next 10
          </button>
        </div>
      </div>

      {/* View/Edit Modal */}
      {isViewModalOpen && selectedQuestion && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-6 w-full max-w-md relative">
            <button
              onClick={() => {
                setIsViewModalOpen(false);
                setIsEditing(false);
                setSelectedQuestion(null);
              }}
              className="absolute top-4 right-4 text-gray-500 hover:text-gray-700"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <div className="flex justify-between items-center mb-4">
              <div className="flex items-center">
                <span className="text-sm text-gray-600 mr-2">Thu Jan 04 2025</span>
                <button className="px-2 py-1 bg-blue-200 text-white rounded text-xs">{selectedQuestion.status}</button>
              </div>
              <div>
                <button className="px-3 py-1 bg-orange-500 text-white rounded-md text-sm mr-2 hover:bg-orange-600">Preview</button>
                <button
                  onClick={() => setIsEditing(true)}
                  className="px-3 py-1 bg-orange-500 text-white rounded-md text-sm hover:bg-orange-600"
                >
                  Edit
                </button>
              </div>
            </div>
            <div className="space-y-4">
              <p className="text-sm text-gray-600">{selectedQuestion.question}</p>
              <div>
                <label className="block text-sm font-medium text-gray-700">Language preference</label>
                <select
                  name="language"
                  value={selectedQuestion.language}
                  onChange={handleChange}
                  disabled={!isEditing}
                  className="mt-1 p-2 w-full border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option>Select Language</option>
                  <option>English</option>
                  <option>Spanish</option>
                  <option>French</option>
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700">Engagement level</label>
                <input
                  type="text"
                  name="engagementLevel"
                  value={selectedQuestion.engagementLevel}
                  onChange={handleChange}
                  disabled={!isEditing}
                  className="mt-1 p-2 w-full border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700">Subscription type</label>
                <input
                  type="text"
                  name="subscriptionType"
                  value={selectedQuestion.subscriptionType}
                  onChange={handleChange}
                  disabled={!isEditing}
                  className="mt-1 p-2 w-full border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700">Select Users</label>
                <input
                  type="text"
                  name="selectedUsers"
                  value={selectedQuestion.selectedUsers}
                  onChange={handleChange}
                  disabled={!isEditing}
                  className="mt-1 p-2 w-full border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
            </div>
            {isEditing && (
              <div className="mt-4 flex justify-end">
                <button
                  onClick={handleSave}
                  className="px-4 py-2 bg-blue-500 text-white rounded-md text-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  Save
                </button>
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  );
};

export default FactQuestions;